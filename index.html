<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Product Picks</title>
<meta name="description" content="Independent product picks. As an Amazon Associate, we earn from qualifying purchases.">
<style>
  :root{
    --bg:#f4f4f9;
    --card:#ffffff;
    --border:#e5e7eb;
    --text:#111827;
    --muted:#6b7280;
    --dark:#0f172a;
    --primary:#111827;
    --soft:#f9fafb;
  }
  *{ box-sizing:border-box; }
  body{ margin:0; font-family: Arial, sans-serif; background:var(--bg); color:var(--text); }
  header{
    background:linear-gradient(135deg,#0f172a,#020617);
    color:#fff; text-align:center;
    padding:22px 12px 14px;
  }
  header h1{ margin:0 0 8px 0; font-size:2em; font-weight:800; letter-spacing:.2px; }
  .topbar{
    display:flex; justify-content:center; gap:10px; flex-wrap:wrap;
    padding:0 12px 6px;
  }
  .country-select, .search-input{
    font-size:14px; padding:8px 10px; border-radius:10px; border:1px solid #d1d5db; outline:none;
  }
  .search-input{ min-width:min(420px, 90vw); }
  .wrap{ max-width:1200px; margin:14px auto 26px; padding:0 12px; }

  /* ===== Compliance banner ===== */
  .compliance{
    background:#fff;
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px 14px;
    line-height:1.55;
  }
  .compliance .row{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:flex-start;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px;
    border:1px solid var(--border);
    background:var(--soft);
    font-size:12px; color:#374151;
    white-space:nowrap;
  }
  .compliance strong{ font-weight:800; }
  .compliance .small{ font-size:12px; color:#4b5563; margin-top:8px; }
  .compliance a{ color:#2563eb; text-decoration:none; }

  /* ===== Status bar ===== */
  .status-bar{
    display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
    margin-top:12px;
    background:#fff; border:1px solid var(--border); border-radius:14px;
    padding:10px 12px;
  }
  .badge{ font-size:12px; padding:4px 10px; border-radius:999px; border:1px solid var(--border); background:var(--soft); }
  .muted{ color:var(--muted); font-size:12px; }
  .btn{
    cursor:pointer; border-radius:12px; border:1px solid var(--border);
    padding:9px 12px; font-weight:800; font-size:13px;
    background:var(--primary); color:#fff;
  }
  .btn:hover{ opacity:.92; }
  .btn.secondary{ background:#fff; color:#111827; }

  /* ===== How to choose ===== */
  .howto{
    margin-top:12px;
    background:#fff;
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px 14px;
  }
  .howto h2{ margin:0 0 8px 0; font-size:16px; }
  .howto .cols{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:10px;
  }
  @media(max-width:780px){ .howto .cols{ grid-template-columns:1fr; } }
  .howto .item{
    background:var(--soft);
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 10px;
  }
  .howto .item h3{ margin:0 0 6px 0; font-size:13px; }
  .howto .item p{ margin:0; font-size:12px; color:#374151; line-height:1.55; }
  .howto .note{
    margin-top:10px;
    font-size:12px;
    color:#4b5563;
    line-height:1.6;
  }

  /* ===== Grid ===== */
  .grid{
    margin-top:14px;
    display:grid;
    grid-template-columns:repeat(3, minmax(0, 1fr));
    gap:14px;
  }
  @media (max-width: 980px){ .grid{ grid-template-columns:repeat(2, minmax(0, 1fr)); } }
  @media (max-width: 640px){ .grid{ grid-template-columns:repeat(1, minmax(0, 1fr)); } }

  .card{
    background:#fff;
    border:1px solid var(--border);
    border-radius:16px;
    padding:12px;
    box-shadow:0 10px 24px rgba(0,0,0,.04);
  }
  .image-wrap{
    display:flex; flex-direction:column; align-items:center; gap:10px;
  }
  .product-image{
    width:100%;
    max-width:360px;
    aspect-ratio:1/1;
    object-fit:contain;
    border-radius:16px;
    border:1px solid var(--border);
    background:#fff;
    cursor:pointer;
    transition: transform .12s ease;
    display:block;
  }
  .product-image:hover{ transform:scale(1.02); }

  /* ✅ 不展示 ASIN 行（页面隐藏） */
  .asin{ display:none !important; }

  /* ✅ 自动生成的中立说明 */
  .product-notes{
    width:100%;
    max-width:360px;
    margin-top:6px;
    padding:8px 10px;
    background:#f9fafb;
    border:1px solid #e5e7eb;
    border-radius:12px;
    font-size:12px;
    color:#374151;
    line-height:1.55;
  }
  .product-notes strong{ font-weight:800; }

  .actions{
    width:100%;
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    margin-top:2px;
  }
  .cta{
    width:min(260px, 100%);
    text-align:center;
    text-decoration:none;
    display:inline-flex;
    justify-content:center;
    align-items:center;
  }

  .empty{
    margin-top:14px;
    padding:14px;
    border:1px solid var(--border);
    border-radius:14px;
    background:#fff;
    color:var(--muted);
    text-align:center;
    font-size:14px;
  }

  /* ===== Modal ===== */
  .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); padding-top:60px; z-index:999; }
  .modal-inner{
    width:90%; max-width:560px; margin:0 auto;
    background:#fff; border-radius:16px; padding:14px; position:relative;
    box-shadow:0 10px 30px rgba(0,0,0,.18);
  }
  .close{
    position:absolute; right:14px; top:10px; font-size:26px; font-weight:900; cursor:pointer; user-select:none;
  }
  .contact-btn{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:12px;
    background:#fff; color:#111827; text-decoration:none; border:1px solid var(--border);
    font-weight:900; font-size:14px;
  }
  .contact-btn:hover{ background:#f9fafb; }
  .mini-hint{
    margin-top:10px;font-size:12px;color:#6b7280;line-height:1.55;
  }

  footer{
    margin-top:18px;
    background:#fff; border-top:1px solid var(--border);
    padding:16px 12px;
  }
  footer .inner{ max-width:1200px; margin:0 auto; font-size:12px; color:#374151; line-height:1.7; }
  footer a{ color:#2563eb; text-decoration:none; }
</style>
</head>
<body>

<header>
  <h1>Product Picks</h1>
  <div class="topbar">
    <select class="country-select" id="countrySelect" onchange="onMarketChange()">
      <option value="US">US</option>
      <option value="UK">UK</option>
      <option value="DE">DE</option>
      <option value="FR">FR</option>
      <option value="IT">IT</option>
      <option value="ES">ES</option>
      <option value="CA">CA</option>
      <option value="JP">JP</option>
    </select>
    <input class="search-input" id="searchInput" placeholder="Search by ASIN / title…" oninput="renderGrid()"/>
  </div>
</header>

<div class="wrap">

  <div class="compliance">
    <div class="row">
      <div class="pill"><strong>Disclosure</strong>: As an Amazon Associate, we earn from qualifying purchases.</div>
      <div class="pill">Independent site · Not endorsed by Amazon</div>
    </div>
    <div class="small">
      Amazon and the Amazon logo are trademarks of Amazon.com, Inc. or its affiliates. We provide independent product references and redirect you to Amazon for purchase.
      See <a href="./privacy.html" target="_blank" rel="noopener">Privacy Policy</a> and <a href="./terms.html" target="_blank" rel="noopener">Terms</a>.
    </div>
  </div>

  <div class="status-bar">
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
      <span class="badge" id="statusBadge">Loading…</span>
      <span class="muted" id="statusMeta"></span>
    </div>
    <button class="btn" onclick="fetchProductData(true)">Refresh</button>
  </div>

  <div class="howto">
    <h2>How to choose</h2>
    <div class="cols">
      <div class="item">
        <h3>1) Confirm compatibility</h3>
        <p>Before buying, confirm model/size/region compatibility on the Amazon product page, especially for electronics, consumables, and replacement parts.</p>
      </div>
      <div class="item">
        <h3>2) Check seller & fulfillment</h3>
        <p>Prefer reputable sellers and reliable fulfillment methods. Review shipping speed, return policy, and warranty terms on Amazon.</p>
      </div>
      <div class="item">
        <h3>3) Compare variants</h3>
        <p>Many products have variants (color, bundle, capacity). Make sure you select the correct variant on Amazon before checkout.</p>
      </div>
      <div class="item">
        <h3>4) Read recent reviews</h3>
        <p>Focus on recent verified purchase reviews. Pay attention to recurring issues (durability, sizing, missing parts) rather than single outliers.</p>
      </div>
    </div>
    <div class="note">
      Note: We do not guarantee pricing or availability. Final product details, pricing, and purchase terms are provided by Amazon on the destination page.
    </div>
  </div>

  <div class="grid" id="productGrid"></div>

  <div class="empty" id="emptyHint" style="display:none;">
    No products loaded. Ensure <code>products.json</code> is available in this folder and contains items for the selected market.
  </div>

</div>

<!-- Modal: Contact & Copy -->
<div class="modal" id="contactModal" onclick="closeContactModal(event)">
  <div class="modal-inner" onclick="event.stopPropagation()">
    <span class="close" onclick="closeContactModal(event)">×</span>

    <h3 style="margin:0 0 10px 0;">Contact & Copy</h3>
    <div style="font-size:13px;color:#6b7280;margin-bottom:8px;">
      Copy only Title / ASIN / Market. Contact buttons are for consultation and do not include Amazon links.
    </div>

    <div id="contactPreview"
         style="border:1px solid #e5e7eb;border-radius:14px;padding:10px;background:#f9fafb;white-space:pre-wrap;font-size:13px;line-height:1.45;text-align:left;"></div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px;">
      <button class="btn" onclick="copyContactInfo()" style="background:#374151;">Copy info</button>
      <a class="contact-btn" href="#" id="contactWA" rel="noopener noreferrer" target="_blank">WhatsApp</a>
      <a class="contact-btn" href="#" id="contactTG" rel="noopener noreferrer" target="_blank">Telegram</a>
      <a class="contact-btn" href="#" id="contactMail" rel="noopener noreferrer" target="_blank">Email</a>
      <button class="btn secondary" onclick="closeContactModal(event)">Close</button>
    </div>

    <div class="mini-hint">
      For purchase, use the “View on Amazon” button on the product card. Final pricing and availability are provided by Amazon on the destination page.
    </div>
  </div>
</div>

<footer>
  <div class="inner">
    <div><strong>Affiliate disclosure:</strong> As an Amazon Associate, we earn from qualifying purchases.</div>
    <div><strong>Independence:</strong> This site is not an official Amazon website and is not endorsed by Amazon.</div>
    <div><strong>Links:</strong> “View on Amazon” redirects to Amazon. Amazon may use cookies for tracking qualifying purchases.</div>
    <div style="margin-top:6px;">
      <a href="./privacy.html" target="_blank" rel="noopener">Privacy Policy</a> ·
      <a href="./terms.html" target="_blank" rel="noopener">Terms of Use</a>
    </div>
    <div style="margin-top:6px;">© 2025 ama.omino.top</div>
  </div>
</footer>

<script>
  const PRODUCTS_JSON_PATH = "./products.json";

  // Contact (咨询用：不携带任何 Amazon 链接)
  const WA_PHONE = "8615778673666";
  const TG_USERNAME = "dalemyrong";
  const EMAIL_CONTACT = "info@dalemy.top";

  const AUTO_REFRESH_MS = 60 * 1000;

  let ALL_PRODUCTS = [];
  let LAST_LOADED_AT = null;
  let CURRENT_CONTACT_PRODUCT = null;

  function currentMarket(){
    return (document.getElementById("countrySelect").value || "US").toUpperCase();
  }

  function normalizeUrl(u){
    const s = String(u || "").trim();
    if (!s) return "";
    if (/^https?:\/\//i.test(s)) return s;
    return "";
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#39;");
  }

  function setStatus(text, meta=""){
    document.getElementById("statusBadge").textContent = text;
    document.getElementById("statusMeta").textContent = meta;
  }

  function showEmpty(show){
    document.getElementById("emptyHint").style.display = show ? "block" : "none";
  }

  function fetchProductData(manual=false){
    const url = PRODUCTS_JSON_PATH + "?ts=" + Date.now();
    setStatus(manual ? "Refreshing…" : "Loading…", "Fetching products.json");

    fetch(url, { cache:"no-store" })
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
        return res.json();
      })
      .then(list => {
        if (!Array.isArray(list)) throw new Error("products.json is not an array");
        ALL_PRODUCTS = list.map((p, idx) => ({...p, __idx: idx}));
        LAST_LOADED_AT = new Date();
        renderGrid();
        setStatus("Loaded", `${ALL_PRODUCTS.length} items · ${LAST_LOADED_AT.toLocaleString()}`);
        showEmpty(ALL_PRODUCTS.length === 0);
      })
      .catch(err => {
        console.error(err);
        setStatus("Load failed", err.message);
        showEmpty(true);
        if (manual) alert("Failed to load products.json.\n\n" + err.message);
      });
  }

  function getVisibleProducts(){
    const m = currentMarket();
    const q = (document.getElementById("searchInput").value || "").trim().toLowerCase();

    return ALL_PRODUCTS
      .filter(p => String(p.market || "").trim().toUpperCase() === m)
      .filter(p => {
        if (!q) return true;
        const hay = [p.asin, p.title].map(v => String(v || "").toLowerCase()).join(" ");
        return hay.includes(q);
      })
      .sort((a,b) => (a.__idx ?? 0) - (b.__idx ?? 0));
  }

  function encodeProductForOnclick(p){
    const safe = {
      market: p.market || "",
      asin: p.asin || "",
      title: p.title || "",
      link: p.link || "",
      image_url: p.image_url || "",
      __idx: p.__idx ?? 0
    };
    return JSON.stringify(safe)
      .replaceAll("&","\\u0026").replaceAll("<","\\u003c").replaceAll(">","\\u003e");
  }

  function openProductLink(product){
    const url = normalizeUrl(product && product.link);
    if (!url){ alert("This item has no valid Amazon link."); return; }
    window.open(url, "_blank", "noopener,noreferrer");
  }

  /* ===================== Auto Product Notes (neutral) ===================== */
  function classifyProduct(p){
    const t = String(p?.title || "").toLowerCase();
    const has = (...kw) => kw.some(k => t.includes(k));

    if (has("printer", "filament", "pla", "abs", "3d")) return "3d_printing";
    if (has("hoodie", "shirt", "t-shirt", "jacket", "sweater", "dress", "cap", "hat", "pants", "shoes", "sock")) return "apparel";
    if (has("cream", "serum", "lotion", "shampoo", "soap", "skincare", "cosmetic")) return "personal_care";
    if (has("supplement", "vitamin", "capsule", "tablet")) return "supplements";
    if (has("charger", "adapter", "usb", "hdmi", "cable", "battery", "router", "camera", "monitor", "keyboard", "mouse", "earbuds", "headphone")) return "electronics";
    if (has("toy", "game", "kids", "child")) return "kids_toys";
    if (has("kitchen", "pan", "pot", "knife", "cook", "coffee", "mug")) return "kitchen";
    if (has("replacement", "refill", "filter", "cartridge", "spare")) return "replacement";
    if (has("custom", "personalized", "engrave", "print", "your text")) return "customized";
    return "general";
  }

  function buildProductNotes(p){
    const bucket = classifyProduct(p);

    const base = {
      head: "Product notes",
      line3: "On Amazon: review variants, seller, and fulfillment details."
    };

    const notesByBucket = {
      electronics: {
        line1: "Suitable for: everyday use and common setups.",
        line2: "Check before buying: compatibility (model/region), size, and power requirements."
      },
      kitchen: {
        line1: "Suitable for: home and daily kitchen use.",
        line2: "Check before buying: dimensions, material, and care instructions."
      },
      apparel: {
        line1: "Suitable for: everyday wear and gifting.",
        line2: "Check before buying: size chart, color/variant selection, and material."
      },
      personal_care: {
        line1: "Suitable for: personal care routines.",
        line2: "Check before buying: ingredients, usage directions, and personal sensitivity considerations."
      },
      supplements: {
        line1: "Suitable for: general wellness consideration (if applicable).",
        line2: "Check before buying: label details, serving size, and any personal restrictions."
      },
      kids_toys: {
        line1: "Suitable for: family use and gifting.",
        line2: "Check before buying: age suitability, small parts, and safety notes."
      },
      replacement: {
        line1: "Suitable for: regular replacement or refill use.",
        line2: "Check before buying: model fitment, quantity, and specifications."
      },
      customized: {
        line1: "Suitable for: gifting or personalization needs.",
        line2: "Check before buying: customization options, variant selection, and return policy."
      },
      "3d_printing": {
        line1: "Suitable for: 3D printing projects and hobby use.",
        line2: "Check before buying: filament type, diameter, and printer compatibility."
      },
      general: {
        line1: "Suitable for: common use cases depending on your needs.",
        line2: "Check before buying: key specs, size/fit, and selected variant."
      }
    };

    const pick = notesByBucket[bucket] || notesByBucket.general;

    return {
      head: base.head,
      line1: pick.line1,
      line2: pick.line2,
      line3: base.line3
    };
  }

  function productNotesHtml(p){
    const n = buildProductNotes(p);
    return `
      <div class="product-notes">
        <strong>${escapeHtml(n.head)}</strong><br>
        • ${escapeHtml(n.line1)}<br>
        • ${escapeHtml(n.line2)}<br>
        • ${escapeHtml(n.line3)}
      </div>
    `;
  }
  /* ===================== Auto Product Notes end ===================== */

  function renderGrid(){
    const grid = document.getElementById("productGrid");
    const items = getVisibleProducts();
    grid.innerHTML = "";

    items.forEach(p => {
      const asin = String(p.asin || "").trim();
      const img  = String(p.image_url || "").trim();
      const link = normalizeUrl(p.link);

      const card = document.createElement("div");
      card.className = "card";

      const viewAmazon = link
        ? `<a class="btn cta" href="${escapeHtml(link)}" target="_blank" rel="noopener noreferrer nofollow sponsored">View on Amazon</a>`
        : `<button class="btn cta" onclick="alert('No valid Amazon link for this item.');">View on Amazon</button>`;

      card.innerHTML = `
        <div class="image-wrap">
          ${img ? `
            <img class="product-image" src="${escapeHtml(img)}" alt="${escapeHtml(asin || 'Product')}"
                 onclick='openProductLink(${encodeProductForOnclick(p)})' />
          ` : `
            <div class="product-image" style="display:flex;align-items:center;justify-content:center;color:#6b7280;">
              No Image
            </div>
          `}

          <!-- ✅ 元素保留但隐藏（CSS display:none），不在页面展示 -->
          <div class="asin" title="${escapeHtml(asin)}">ASIN: ${escapeHtml(asin || "-")}</div>

          ${productNotesHtml(p)}

          <div class="actions">
            ${viewAmazon}
            <button class="btn cta secondary" onclick='openContactModal(${encodeProductForOnclick(p)})'>Contact / Copy</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });

    showEmpty(items.length === 0);
    if (LAST_LOADED_AT){
      setStatus("Loaded", `${items.length}/${ALL_PRODUCTS.length} visible · ${LAST_LOADED_AT.toLocaleString()}`);
    }
  }

  function onMarketChange(){
    localStorage.setItem("selectedCountry", currentMarket());
    renderGrid();
  }

  function copyText(text){
    if (navigator.clipboard && window.isSecureContext) return navigator.clipboard.writeText(text);
    return new Promise((resolve, reject) => {
      try{
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        resolve();
      }catch(e){ reject(e); }
    });
  }

  // ✅ 复制仍包含：标题 / ASIN / 国家（不包含链接）
  function buildCopyInfo(product){
    const market = String(product.market || "").trim().toUpperCase();
    const asin = String(product.asin || "").trim();
    const title = String(product.title || "").trim();

    const lines = [];
    if (title) lines.push(title);
    if (asin) lines.push(`ASIN: ${asin}`);
    if (market) lines.push(`Market: ${market}`);
    return lines.join("\n");
  }

  // ✅ 咨询文本：三项 + 咨询句子（不含任何链接）
  function buildContactText(product){
    const base = buildCopyInfo(product);
    const lines = [];
    if (base) lines.push(base);
    lines.push("");
    lines.push("Hi, I have a question about this product. Could you please help?");
    return lines.join("\n");
  }

  function openContactModal(product){
    CURRENT_CONTACT_PRODUCT = product;

    const previewText = buildCopyInfo(product);
    document.getElementById("contactPreview").textContent = previewText;

    const contactText = buildContactText(product);

    const waUrl = "https://wa.me/" + WA_PHONE + "?text=" + encodeURIComponent(contactText);
    const tgUrl = "https://t.me/" + TG_USERNAME;

    const subject = `Product question: ${(product.asin||"").trim()} [${(product.market||"").toUpperCase()}]`;
    const mailUrl = "mailto:" + encodeURIComponent(EMAIL_CONTACT)
      + "?subject=" + encodeURIComponent(subject)
      + "&body=" + encodeURIComponent(contactText);

    const waBtn = document.getElementById("contactWA");
    waBtn.href = waUrl;
    waBtn.onclick = (e) => { e.preventDefault(); window.open(waUrl, "_blank", "noopener,noreferrer"); };

    const tgBtn = document.getElementById("contactTG");
    tgBtn.href = tgUrl;
    tgBtn.onclick = (e) => {
      e.preventDefault();
      copyText(contactText)
        .then(() => window.open(tgUrl, "_blank", "noopener,noreferrer"))
        .catch(() => window.open(tgUrl, "_blank", "noopener,noreferrer"));
    };

    const mailBtn = document.getElementById("contactMail");
    mailBtn.href = mailUrl;
    mailBtn.onclick = (e) => { e.preventDefault(); window.open(mailUrl, "_blank", "noopener,noreferrer"); };

    document.getElementById("contactModal").style.display = "block";
  }

  function closeContactModal(){
    document.getElementById("contactModal").style.display = "none";
    CURRENT_CONTACT_PRODUCT = null;
  }

  function closeContactModal(event){
    // allow click backdrop close; keep button close too
    document.getElementById("contactModal").style.display = "none";
    CURRENT_CONTACT_PRODUCT = null;
  }

  function copyContactInfo(){
    const text = document.getElementById("contactPreview").textContent || "";
    if (!text) return;
    copyText(text).then(() => alert("Copied!")).catch(() => alert("Copy failed"));
  }

  window.onload = function(){
    const saved = localStorage.getItem("selectedCountry");
    if (saved) document.getElementById("countrySelect").value = saved;

    fetchProductData(false);
    setInterval(() => fetchProductData(false), AUTO_REFRESH_MS);
  };
</script>
</body>
</html>
